<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Morador - Sistema de Gestão de Condomínios</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <link href="css/cadastro-morador.css" rel="stylesheet">
</head>
<body>
    <div class="container py-5">
        <div class="card">
            <div class="card-header">
                <h2 class="mb-0"><i class="bi bi-person-plus-fill me-2"></i>Cadastro de Morador</h2>
            </div>
            <div class="card-body">
                <form id="cadastroMoradorForm" class="needs-validation" novalidate>
                    <!-- Informações Pessoais -->
                    <h4 class="section-title"><i class="bi bi-person me-2"></i>Informações Pessoais</h4>
                    <div class="row g-3 mb-4">
                        <div class="col-12 text-center">
                            <div class="avatar-preview">
                                <img src="assets/default-avatar.png" alt="Preview" id="avatarPreview">
                            </div>
                            <div class="custom-file-upload" id="avatarUpload">
                                <i class="bi bi-cloud-upload fs-3 mb-2"></i>
                                <p class="mb-0">Clique ou arraste uma foto</p>
                                <input type="file" id="avatarInput" accept="image/*" class="d-none">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="text" class="form-control" id="nome" placeholder="Nome completo" required>
                                <label for="nome" class="required-field">Nome Completo</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="text" class="form-control" id="cpf" placeholder="CPF" required>
                                <label for="cpf" class="required-field">CPF</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="email" class="form-control" id="email" placeholder="E-mail" required>
                                <label for="email" class="required-field">E-mail</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="tel" class="form-control" id="telefone" placeholder="Telefone" required>
                                <label for="telefone" class="required-field">Telefone</label>
                            </div>
                        </div>
                    </div>

                    <!-- Informações da Unidade -->
                    <h4 class="section-title"><i class="bi bi-house me-2"></i>Informações da Unidade</h4>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <div class="form-floating">
                                <select class="form-select" id="bloco" required>
                                    <option value="">Selecione...</option>
                                    <option value="A">Bloco A</option>
                                    <option value="B">Bloco B</option>
                                    <option value="C">Bloco C</option>
                                </select>
                                <label for="bloco" class="required-field">Bloco</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="text" class="form-control" id="unidade" placeholder="Unidade" required>
                                <label for="unidade" class="required-field">Número da Unidade</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <select class="form-select" id="tipo" required>
                                    <option value="">Selecione...</option>
                                    <option value="proprietario">Proprietário</option>
                                    <option value="inquilino">Inquilino</option>
                                </select>
                                <label for="tipo" class="required-field">Tipo de Ocupação</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="date" class="form-control" id="dataEntrada" required>
                                <label for="dataEntrada" class="required-field">Data de Entrada</label>
                            </div>
                        </div>
                    </div>

                    <!-- Informações Financeiras -->
                    <h4 class="section-title"><i class="bi bi-cash me-2"></i>Informações Financeiras</h4>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="number" class="form-control" id="valorMensalidade" placeholder="Valor da Mensalidade" required>
                                <label for="valorMensalidade" class="required-field">Valor da Mensalidade (R$)</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <select class="form-select" id="diaVencimento" required>
                                    <option value="">Selecione...</option>
                                    <option value="5">Dia 5</option>
                                    <option value="10">Dia 10</option>
                                    <option value="15">Dia 15</option>
                                    <option value="20">Dia 20</option>
                                </select>
                                <label for="diaVencimento" class="required-field">Dia de Vencimento</label>
                            </div>
                        </div>
                    </div>

                    <!-- Veículos -->
                    <h4 class="section-title"><i class="bi bi-car-front me-2"></i>Veículos</h4>
                    <div id="veiculosContainer">
                        <div class="row g-3 mb-3 veiculo-item">
                            <div class="col-md-4">
                                <div class="form-floating">
                                    <input type="text" class="form-control" name="placa[]" placeholder="Placa">
                                    <label>Placa</label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-floating">
                                    <input type="text" class="form-control" name="modelo[]" placeholder="Modelo">
                                    <label>Modelo</label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-floating">
                                    <input type="text" class="form-control" name="cor[]" placeholder="Cor">
                                    <label>Cor</label>
                                </div>
                            </div>
                            <div class="col-md-1 d-flex align-items-center">
                                <button type="button" class="btn btn-danger remove-veiculo"><i class="bi bi-trash"></i></button>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-secondary mb-4" id="addVeiculo">
                        <i class="bi bi-plus-circle me-2"></i>Adicionar Veículo
                    </button>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="button" class="btn btn-outline-secondary me-md-2">
                            <i class="bi bi-x-circle me-2"></i>Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle me-2"></i>Salvar Cadastro
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/inputmask@5.0.5/dist/inputmask.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Máscaras de input
            Inputmask({ mask: "999.999.999-99" }).mask(document.getElementById("cpf"));
            Inputmask({ mask: "(99) 99999-9999" }).mask(document.getElementById("telefone"));

            // Preview da foto
            const avatarInput = document.getElementById('avatarInput');
            const avatarPreview = document.getElementById('avatarPreview');
            const avatarUpload = document.getElementById('avatarUpload');

            avatarUpload.addEventListener('click', () => avatarInput.click());
            avatarInput.addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        avatarPreview.src = e.target.result;
                    }
                    reader.readAsDataURL(e.target.files[0]);
                }
            });

            // Adicionar/Remover veículos
            const veiculosContainer = document.getElementById('veiculosContainer');
            document.getElementById('addVeiculo').addEventListener('click', function() {
                const veiculoItem = veiculosContainer.querySelector('.veiculo-item').cloneNode(true);
                veiculoItem.querySelectorAll('input').forEach(input => input.value = '');
                veiculosContainer.appendChild(veiculoItem);
            });

            veiculosContainer.addEventListener('click', function(e) {
                if (e.target.classList.contains('remove-veiculo') || e.target.parentElement.classList.contains('remove-veiculo')) {
                    const veiculoItem = e.target.closest('.veiculo-item');
                    if (veiculosContainer.querySelectorAll('.veiculo-item').length > 1) {
                        veiculoItem.remove();
                    }
                }
            });

            // Validação e envio do formulário
            const form = document.getElementById('cadastroMoradorForm');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                if (!form.checkValidity()) {
                    e.stopPropagation();
                    form.classList.add('was-validated');
                    return;
                }

                // Aqui você pode adicionar a lógica para enviar os dados para o servidor
                const formData = new FormData(form);
                fetch('/api/moradores', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(Object.fromEntries(formData))
                })
                .then(response => response.json())
                .then(data => {
                    Swal.fire({
                        icon: 'success',
                        title: 'Sucesso!',
                        text: 'Morador cadastrado com sucesso.',
                        confirmButtonColor: '#3498db'
                    }).then(() => {
                        window.location.href = 'moradores.html';
                    });
                })
                .catch(error => {
                    Swal.fire({
                        icon: 'error',
                        title: 'Erro!',
                        text: 'Ocorreu um erro ao cadastrar o morador.',
                        confirmButtonColor: '#e74c3c'
                    });
                });
            });
        });
    </script>
</body>
</html>